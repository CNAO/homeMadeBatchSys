# homeMadeBatchSys
This repo collects settings and scripts of a very simple, home-made batch system.
Nota Bene: the system is supposed to run on a linux machine!

The system is not designed for very large CPU farms; on the contrary, it is meant to simply automatically submit jobs on a multi-core/multi-thread CPU.
The system can be checked out and made running very easily.
If this system does not suite your needs, please check more popular batch systems - e.g. [htcondor](https://research.cs.wisc.edu/htcondor/)

The system is based on a crontab job, checking the status of the CPUs on a regular basis, and a simple script to find new jobs, submit them (if it is the case) and archive files of finished jobs.

```
# Example of crontab job, forcing the use of 5 CPUs/threads for crunching jobs
7,17,27,37,47,57 *  *   *   *     cd /home/amereghe/homeMadeBatchSys ; ./submit.sh 5 2>&1 >> submit.sh.log

# The same example, where the script auto-detects the number of available CPUs and allocate them but 1 for crunching jobs
7,17,27,37,47,57 *  *   *   *     cd /home/amereghe/homeMadeBatchSys ; ./submit.sh 2>&1 >> submit.sh.log
```

## How to submit
### Preparation
For every job you would like to run, please create a bash script (hereafter referred to as ''job script'') with all the necessary commands.
You can take inspiration from the examples in the `templates` folder.
It is extremely important that:
* every job script has a unique name - e.g. `job_myCase_with_this_parameter_and_that_parameter_2022-11-09.sh`;
* the job script is executable. In linux, you can make a file executable via the command `chmod`;
* in the job script, you declare all the necessary environment variables, including where the job should run (hereafter referred to as ''running folder'');
* please `cd` into the running folder, such that all the files written by the simulation (with the only exception of the job log, see later) can be found there.

### Actual submission
In order to submit a job, it is sufficient to copy the job script in the `queueing` folder.
When resources will become available, the job will start: the job script will be moved to the parent folder and run by the system with the owner credentials.
All the text generated by the job script onto `STDOUT` or `STDERR` will be re-directed in the `<job_script_name>.log` file of the job.

### End of job
Once the job will be over, the job script and the `.log` will be moved to the `finished` folder.
